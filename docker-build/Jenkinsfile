pipeline {
  environment {
     
        KUBECONFIG = credentials('kubernetescred')
    }
  agent none
  stages {
    stage('checkout & build backend') {
            
            agent {
                kubernetes {
                inheritFrom 'kube-2'
                defaultContainer 'alpine'

            }
            }
            steps {
       
        //   git branch: 'jenkins', url: 'https://github.com/ahmed-eldesoki/udapeople.git'
     
          sh '''
                pwd
                    '''
   }
  }
     stage('building docker image') {

      agent {
                node {
                label 'jenkins'
                
            }
            }
           
      steps {         
              
        script {
     dockerImage = docker.build("ahmedeldesoki/udabackend:${BUILD_NUMBER}", "./backend")
      withDockerRegistry([ credentialsId: "docker-hub", url: "" ]) {
                 dockerImage.push()
      }
      }      
      }     
    }
    
  }
}